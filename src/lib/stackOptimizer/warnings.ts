/**\n * Warnings system for Stack Optimizer\n * Generates non-medical logic-based warnings for research protocol consistency and complexity\n */\n\nexport interface Warning {\n  id: string;\n  level: 'info' | 'warning' | 'alert';\n  title: string;\n  message: string;\n  suggestion?: string;\n}\n\nexport interface WarningFlag {\n  title: string;\n  message: string;\n}\n\nexport interface ScheduleEntry {\n  date: string;\n  timeOfDay: string;\n  dayOfWeek: string;\n  week: number;\n}\n\nexport interface CompoundData {\n  name: string;\n  frequency: string;\n  durationDays: number;\n}\n\n/**\n * Check for warnings based on generated schedule and compounds\n * Returns non-medical, logic-based warnings\n */\nexport function checkWarnings(\n  entries: ScheduleEntry[],\n  compounds: CompoundData[]\n): WarningFlag[] {\n  const warnings: WarningFlag[] = [];\n\n  if (entries.length === 0 || compounds.length === 0) {\n    return warnings;\n  }\n\n  // 1. High daily frequency: Daily + duration >= 14 days\n  const dailyCompounds = compounds.filter((c) => c.frequency === 'daily');\n  for (const compound of dailyCompounds) {\n    if (compound.durationDays >= 14) {\n      warnings.push({\n        title: 'High-frequency protocol detected',\n        message: `\"${compound.name}\" has daily administration for ${compound.durationDays} days. Ensure your research plan is consistent and track observations carefully.`,\n      });\n    }\n  }\n\n  // 2. Many events per day: peak >= 3\n  const eventsByDate = new Map<string, number>();\n  entries.forEach((e) => {\n    eventsByDate.set(e.date, (eventsByDate.get(e.date) || 0) + 1);\n  });\n  const peakDaily = Math.max(0, ...Array.from(eventsByDate.values()));\n  if (peakDaily >= 3) {\n    warnings.push({\n      title: 'Multiple same-day administrations detected',\n      message: `Peak of ${peakDaily} administrations on a single day. Consider grouping times to reduce schedule complexity.`,\n    });\n  }\n\n  // 3. No rest days: events on 7+ consecutive days\n  let consecutiveDays = 0;\n  let maxConsecutive = 0;\n  const sortedDates = Array.from(eventsByDate.keys()).sort();\n  for (let i = 0; i < sortedDates.length; i++) {\n    if (i === 0 || isConsecutiveDate(sortedDates[i - 1], sortedDates[i])) {\n      consecutiveDays++;\n    } else {\n      maxConsecutive = Math.max(maxConsecutive, consecutiveDays);\n      consecutiveDays = 1;\n    }\n  }\n  maxConsecutive = Math.max(maxConsecutive, consecutiveDays);\n  if (maxConsecutive >= 7) {\n    warnings.push({\n      title: 'No rest days detected',\n      message: `${maxConsecutive} consecutive days with administrations. Some researchers prefer rest days for cleaner observation blocks.`,\n    });\n  }\n\n  // 4. Stack complexity: >= 4 compounds OR >= 60 total events\n  if (compounds.length >= 4 || entries.length >= 60) {\n    warnings.push({\n      title: 'High complexity stack',\n      message: `${compounds.length} compound${compounds.length !== 1 ? 's' : ''} with ${entries.length} total administration event${entries.length !== 1 ? 's' : ''}. Consider simplifying for clearer observation attribution.`,\n    });\n  }\n\n  // 5. Time fragmentation: 3+ distinct times on a single day\n  const timesByDate = new Map<string, Set<string>>();\n  entries.forEach((e) => {\n    if (!timesByDate.has(e.date)) {\n      timesByDate.set(e.date, new Set());\n    }\n    timesByDate.get(e.date)!.add(e.timeOfDay);\n  });\n  for (const [date, times] of timesByDate.entries()) {\n    if (times.size >= 3) {\n      warnings.push({\n        title: 'Time fragmentation detected',\n        message: `${times.size} distinct time slots on ${date}. Use 'Simplify schedule' to reduce time slots.`,\n      });\n      break;\n    }\n  }\n\n  return warnings;\n}\n\nfunction isConsecutiveDate(date1: string, date2: string): boolean {\n  const d1 = new Date(date1);\n  const d2 = new Date(date2);\n  const diff = (d2.getTime() - d1.getTime()) / (1000 * 60 * 60 * 24);\n  return diff === 1;\n}\n\n/**\n * Generate warnings based on protocol configuration (legacy function)\n */\nexport function generateWarnings(\n  frequency: string,\n  compoundCount: number,\n  durationDays: number,\n  timeOfDay: string,\n  handlingRequirements: string[] = [],\n  totalAdministrations: number = 0\n): Warning[] {\n  const warnings: Warning[] = [];\n\n  if (frequency === 'daily' && durationDays < 7) {\n    warnings.push({\n      id: 'short-daily',\n      level: 'info',\n      title: 'Short protocol duration',\n      message: 'Daily administration planned for less than 7 days. Consider alignment with research objectives.',\n      suggestion: 'Extend to at least 7 days for more meaningful protocol data.',\n    });\n  }\n\n  if (frequency === 'custom' && compoundCount > 1) {\n    warnings.push({\n      id: 'custom-multiple',\n      level: 'warning',\n      title: 'Custom schedule with multiple compounds',\n      message:\n        'Using custom days with multiple compounds may create inconsistent administration patterns. Ensure all compounds follow the same schedule.',\n      suggestion:\n        'Verify that custom days apply consistently to all compounds in the protocol.',\n    });\n  }\n\n  if (frequency === 'daily' && durationDays > 60) {\n    warnings.push({\n      id: 'prolonged-daily',\n      level: 'warning',\n      title: 'Extended daily protocol',\n      message: 'Daily administration for over 60 days is a lengthy research protocol.',\n      suggestion: 'Consider compliance tracking and storage stability over the extended timeline.',\n    });\n  }\n\n  if (compoundCount > 5) {\n    warnings.push({\n      id: 'too-many-compounds',\n      level: 'warning',\n      title: 'High compound count',\n      message: `${compoundCount} compounds require careful tracking and organization.`,\n      suggestion: 'Verify labeling and organization system. Consider grouping by handling requirements.',\n    });\n  }\n\n  if (\n    handlingRequirements.includes('refrigeration') &&\n    handlingRequirements.includes('light-sensitive')\n  ) {\n    warnings.push({\n      id: 'dual-handling',\n      level: 'warning',\n      title: 'Multiple special handling requirements',\n      message:\n        'Compounds require both refrigeration and light protection. Ensure storage system accommodates both.',\n      suggestion: 'Use amber/opaque containers in refrigerated storage, or specialized protective containers.',\n    });\n  }\n\n  if (timeOfDay === 'both' && totalAdministrations > 20) {\n    warnings.push({\n      id: 'both-times',\n      level: 'info',\n      title: 'AM/PM administration schedule',\n      message: `${totalAdministrations} administrations split between AM and PM. Ensure consistent timing windows.`,\n      suggestion: 'Define specific AM window (e.g., 6-10 AM) and PM window (e.g., 4-8 PM) for consistency.',\n    });\n  }\n\n  if (durationDays < 7 && frequency !== 'daily') {\n    warnings.push({\n      id: 'short-research',\n      level: 'info',\n      title: 'Short research protocol',\n      message: 'Protocol duration less than 7 days may not provide sufficient data points.',\n      suggestion: 'Ensure protocol duration aligns with research objectives.',\n    });\n  }\n\n  if (totalAdministrations > 50) {\n    warnings.push({\n      id: 'high-burden',\n      level: 'warning',\n      title: 'High administration frequency',\n      message: `${totalAdministrations} total administrations across the protocol.`,\n      suggestion: 'Ensure adequate organization and tracking systems for compliance.',\n    });\n  }\n\n  if (frequency === '3x/week' && durationDays < 14) {\n    warnings.push({\n      id: 'insufficient-weeks',\n      level: 'info',\n      title: 'Limited protocol weeks',\n      message: '3x/week schedule over less than 2 weeks provides limited data.',\n      suggestion: 'Extend protocol to at least 2-4 weeks for better protocol consistency.',\n    });\n  }\n\n  return warnings;\n}\n\n/**\n * Get color classes for warning level\n */\nexport function getWarningColor(level: string): string {\n  const colors: Record<string, string> = {\n    info: 'bg-blue-50 border-blue-200 text-blue-800',\n    warning: 'bg-amber-50 border-amber-200 text-amber-800',\n    alert: 'bg-red-50 border-red-200 text-red-800',\n  };\n  return colors[level] || colors.info;\n}\n\n/**\n * Get icon for warning level\n */\nexport function getWarningIcon(level: string): string {\n  const icons: Record<string, string> = {\n    info: 'â„¹',\n    warning: 'âš ',\n    alert: 'ðŸš¨',\n  };\n  return icons[level] || icons.info;\n}\n"
